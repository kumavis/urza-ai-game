(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
module.exports=[
  {
    "basic_land": "",
    "flavorText": "A place to seek solace and a spot to regain her lost freedom.",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "As an additional cost to cast this spell, sacrifice a creature.\nDraw two cards.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The savor's journey will begin on its journey.",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Choose one —\n• Exile target creature. Creatures you control get +1/+1 until end of turn.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "If you cast a sentry, it carries with it a guard of those who see it.",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Kicker {1} (You may pay an additional {1} as you cast this spell.)\nCounter target spell if its mana value is 1 or less.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"If you know a warrior will lead them into battle, guide them to victory. If you know a foe will lead them into battle, guide them to victory.\"",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Cast this spell only if you control a creature with power 4 or greater.\nCreate two 1/1 white Spirit creature tokens with flying.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The first thing the center of the battlefield of a place is working on is just the way the bell hangs.",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Choose one —\n• Destroy target artifact.\n• Draw a card.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"In this world, there are many types of creatures. We will deal with them all.\"",
    "loyalty": "",
    "manaCost": "{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Buyback {2} (You may pay an additional {2} as you cast this spell. If you do, put this card into your hand as it resolves.)\nCreate a 2/2 red Elemental creature token.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"The Black Prophecy is already being fulfilled. What does it matter if we die this time?\"",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Counter target creature spell.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The arrow seems to be headed for you.",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Kicker {2} (You may pay an additional {2} as you cast this spell.)\nTarget creature gets +2/+2 until end of turn. If this spell was kicked, that creature gets +0/+2 until end of turn instead.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "": "Avoid: Counter target spell.",
    "basic_land": "",
    "flavorText": "The twig wizards would have a hard time opening the blackasures to gather the spears for example.",
    "loyalty": "",
    "manaCost": "{1}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "",
    "toughness": "",
    "types": "",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"Even the baddest things die. Sometimes they even die of their own accord.\"\n—Emmara",
    "loyalty": "",
    "manaCost": "{1}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Until end of turn, whenever a creature dies, target creature gets +1/+0 and gains haste.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The image of a sentience organ is a forever chance of falling.",
    "loyalty": "",
    "manaCost": "{2}",
    "name": "",
    "power": "1",
    "rarity": "common",
    "subtypes": "Juggernaut",
    "text": "Flying\n{2}, Sacrifice another artifact: Put a +1/+1 counter on target creature.",
    "toughness": "1",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The human survivors must bury their dead in a non- Human-controlled version of the Piety known as \"Non-Human Shrine with Nothing on it.\"",
    "loyalty": "",
    "manaCost": "{2}",
    "name": "",
    "power": "2",
    "rarity": "common",
    "subtypes": "Construct",
    "text": "When this creature dies, return it to the battlefield under your control at the beginning of the next end step.",
    "toughness": "2",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"Selesnya, son of Serra. A beloved of our race. It was the reason my mother thought me to be in need of rest.\"",
    "loyalty": "",
    "manaCost": "{2}",
    "name": "",
    "power": "1",
    "rarity": "uncommon",
    "subtypes": "Construct",
    "text": "When you cast this spell, sacrifice an artifact or creature.\n{1}, {T}: Add {C}.",
    "toughness": "1",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"When the shape of the forest has changed, some life can't be formed in it. Then, I used to cut it, and some life appeared in it.\"\n—Chandra Nalaar",
    "loyalty": "",
    "manaCost": "{1}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "You may put a creature card from your hand onto the battlefield.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "Once each turn, if you are a new warrior, break the neck of a demon.",
    "loyalty": "",
    "manaCost": "{1}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Buyback {2} (You may pay an additional {2} as you cast this spell. If you do, put this card into your hand as it resolves.)\nCreate a 2/2 red Devil creature token with flying.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "Some indestructible sculptors in life, but just in case.",
    "loyalty": "",
    "manaCost": "{2}",
    "name": "",
    "power": "2",
    "rarity": "common",
    "subtypes": "Golem",
    "text": "{1}, Sacrifice Artificer conjurer (When this creature enters the battlefield, you may return target artifact card with mana value 2 or less from your graveyard to your hand.)",
    "toughness": "2",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"The poppets are long live. If it has a fleabag as long as it, it has to\" (There is no such thing as a fella. It's just a tip if it has to be a bitty.)",
    "loyalty": "",
    "manaCost": "{2}",
    "name": "",
    "power": "0",
    "rarity": "common",
    "subtypes": "Scarecrow",
    "text": "{3}, {T}: Create a 2/2 blue Insect creature token.",
    "toughness": "1",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "Those who seek death for others take on a masterful mage's bearing.",
    "loyalty": "",
    "manaCost": "{2}",
    "name": "",
    "power": "1",
    "rarity": "common",
    "subtypes": "Insect",
    "text": "Flying\n{1}, Sacrifice another creature: Target creature gets +2/+2 until end of turn.",
    "toughness": "1",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"Hold, little bird. Don't fall into that beak of Scavengers.\"",
    "loyalty": "",
    "manaCost": "{1}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Tap all creatures target player controls.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "Some cannot reproduce it.",
    "loyalty": "",
    "manaCost": "{1}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "This spell costs {1} less to cast if you control a Plains.\nDraw a card.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"What makes the Froststeel Fleet one of the greatest navies is not simply the magnificent ability to detect enemy battle traffic. It is the skill to exploit the ship's position to surprise an enemy while not getting in its way.\"\n—Zyd, *Ulae constable, *Vec songfletcher*",
    "loyalty": "",
    "manaCost": "{1}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Put target creature card from a graveyard onto the battlefield under your control.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "His form is that of a tireless bull. His aim is the perfect gift: \"My own family, a distant but ever-watchful friend. My home, a perfect realm of harmony.\"",
    "loyalty": "",
    "manaCost": "{2}",
    "name": "",
    "power": "2",
    "rarity": "common",
    "subtypes": "Juggernaut",
    "text": "{2}, Sacrifice No more than one creature: You gain life equal to the sacrificed creature's toughness.",
    "toughness": "2",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The meek return to the warped battlefield.",
    "loyalty": "",
    "manaCost": "{1}{B}",
    "name": "Fiendish Conditioning Actuarial",
    "power": "2",
    "rarity": "common",
    "subtypes": "Zombie",
    "text": "Flash\nAt the beginning of your upkeep, mill three cards. (Put the top three cards of your library into your graveyard.)",
    "toughness": "1",
    "types": "Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"What's so special about the shape of my horn?\"",
    "loyalty": "",
    "manaCost": "{1}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Untap target creature.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The guide of the merfolk, the fallen griffin.",
    "loyalty": "",
    "manaCost": "{2}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Choose one —\n• Destroy target artifact.\n• Exile target artifact.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "Otrimi's verdict was unthinkable. Now if it had been 5 or less, the distinction between an unthinkable, unremembered prophecy was just a taste of what a future world might look like.",
    "loyalty": "",
    "manaCost": "{3}",
    "name": "",
    "power": "",
    "rarity": "When the wizardly text was still on the battlefield, the distance between two target players was, on paper, ten miles.",
    "subtypes": "",
    "text": "",
    "toughness": "",
    "types": "",
    "url": ""
  },
  {
    "": "Today's Tutor recommends Accomplice's Teacher's Hand and Blue Rider.",
    "basic_land": "",
    "flavorText": "Kiora, one that fosters and furthers. The thought-partnering quality of his commitment to a vision for the present.",
    "loyalty": "",
    "manaCost": "{2}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "",
    "toughness": "",
    "types": "",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The behemoths do not hunt the living. The shamans kill the dead.",
    "loyalty": "",
    "manaCost": "{2}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Exile target creature card from a graveyard.\nDraw a card.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "activated forces cost": "{1}",
    "basic_land": "",
    "flavorText": "The condensed version of its leaf form.",
    "loyalty": "",
    "manaCost": "{3}",
    "name": "",
    "power": "0",
    "rarity": "rare",
    "subtypes": "Construct",
    "text": "When this creature enters the battlefield, create a token that's a copy of a creature token you control.",
    "toughness": "4",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "": "",
    "basic_land": "",
    "flavorText": "\"Is it dead?\"",
    "loyalty": "",
    "manaCost": "{3}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Put target creature on top of its owner's library.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "",
    "loyalty": "",
    "manaCost": "{2}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Cast this spell only if you control a Plains, Island, Swamp, Mountain, and/or Forest.\nFlavorText : A rivers face glides like milk as it crashes through the land.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "It means the only one to fight in the fray is the fighting hand.",
    "loyalty": "",
    "manaCost": "{2}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Add {R} for each artifact you control.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "A sweet memory for those who matter most.",
    "loyalty": "",
    "manaCost": "{1}{R}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Cast this spell only if you control a creature with power 4 or greater.\nTarget creature can't block this turn.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"Gum is good. Dig for it, and it will bring you far. Listen to its gummy counsel. That will make you even more sure it is on your side.\"",
    "loyalty": "",
    "manaCost": "{3}",
    "name": "",
    "power": "1",
    "rarity": "common",
    "subtypes": "Human Wizard",
    "text": "{T}: Target creature gets +1/+0 until end of turn.",
    "toughness": "1",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "": "Even the least expensive approach is the least beautiful.",
    "FlavorText": "Wipe away every trace of blood from your hand.",
    "basic_land": "",
    "flavorText": "",
    "loyalty": "",
    "manaCost": "{2}{R}",
    "name": "",
    "power": "",
    "rarity": "",
    "subtypes": "",
    "text": "",
    "toughness": "",
    "types": "",
    "url": "",
    "{2}{R}": "Sacrifice your creature."
  },
  {
    "basic_land": "",
    "flavorText": "\"Reel and have it broke, once.\"",
    "loyalty": "",
    "manaCost": "{3}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Counter target creature or planeswalker spell. Create a 2/2 red Goblin creature token with haste.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"They use more intricate guildspeak than we do.\"\n—Rothok Vol",
    "loyalty": "",
    "manaCost": "{3}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Choose one —\n• Creatures you control get +1/+0 until end of turn.\n• Create a token that's a copy of target creature you control.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"Baza el-Dal has now returned. All the treasures of the temple of Haddad await you.\"",
    "loyalty": "",
    "manaCost": "{4}",
    "name": "",
    "power": "1",
    "rarity": "common",
    "subtypes": "Human Wizard",
    "text": "{T}: Add {C} or {R}.",
    "toughness": "1",
    "types": "Artifact Creature",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "In Auriok see us magic ",
    "loyalty": "",
    "manaCost": "{4}",
    "name": "The Ruin Elemental Assembly",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Return target creature card with mana value 4 or less from your graveyard to your hand.",
    "toughness": "",
    "types": "Sorcery",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"He sees only fear and only despair. In this way, I will show him how far I can go.\"\n—Volrath",
    "loyalty": "",
    "manaCost": "{2}{R}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Gain control of target creature until end of turn. Untap that creature. It gains haste until end of turn.",
    "toughness": "",
    "types": "Sorcery",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"They simply need to take down a massive pile of pieces to take down.\"\n—Maggothault",
    "loyalty": "",
    "manaCost": "{3}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Choose one —\n• Destroy target artifact.\n• Target creature gets +2/+0 until end of turn.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "\"A long, clear prayer is all it needs to save a city.\"\n—Ral Zarek",
    "loyalty": "",
    "manaCost": "{1}{R}{R}{R}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "Choose one —\n• Exile target creature with the same power and toughness twice.\n• Return target creature card from your graveyard to the battlefield.",
    "toughness": "",
    "types": "Sorcery",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The touch of one thousand makes the silver rule's last practice.",
    "loyalty": "",
    "manaCost": "{4}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "Gain control of target creature with power 4 or less.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "Some spell you have cast out of memory is at a place not on the battlefield.",
    "loyalty": "",
    "manaCost": "{4}{R}",
    "name": "",
    "power": "",
    "rarity": "rare",
    "subtypes": "",
    "text": "You may sacrifice a land. If you do, copy this spell. You may choose new targets for the copy.\nDraw a card.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "Some heralds disappear into the Multiverse, creating a stir among the enslaved of all who can read.",
    "loyalty": "",
    "manaCost": "{3}{R}{R}",
    "name": "",
    "power": "",
    "rarity": "rare",
    "subtypes": "",
    "text": "Target player gains control of all artifacts and creatures of their choice until end of turn.",
    "toughness": "",
    "types": "Sorcery",
    "url": ""
  },
  {
    "": "Acceptable options are: Volcano Runeflare.",
    "basic_land": "",
    "flavorText": "A touch of anger tears down mountains, splitting earth and water.",
    "loyalty": "",
    "manaCost": "{6}",
    "name": "",
    "power": "",
    "rarity": "uncommon",
    "subtypes": "",
    "text": "",
    "toughness": "",
    "types": "",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The aesques scream as their gazes trace the deck's astral projections.",
    "loyalty": "",
    "manaCost": "{3}{R}{R}{R}",
    "name": "",
    "power": "",
    "rarity": "rare",
    "subtypes": "",
    "text": "Search your library for a creature card, put it onto the battlefield, then shuffle.",
    "toughness": "",
    "types": "Sorcery",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The one who keeps a full edge on a saddle makes their jhess around the arena, and is their chief advisor.",
    "loyalty": "",
    "manaCost": "{4}{R}{R}",
    "name": "",
    "power": "",
    "rarity": "rare",
    "subtypes": "",
    "text": "Each player chooses any number of cards from their hand. The player whose hand contains the chosen cards discards those cards.",
    "toughness": "",
    "types": "Sorcery",
    "url": ""
  },
  {
    "basic_land": "",
    "flavorText": "The bearer bears the grisly marks of the grisly deed the bearer did.",
    "loyalty": "",
    "manaCost": "{5}{R}",
    "name": "",
    "power": "",
    "rarity": "common",
    "subtypes": "",
    "text": "If you control a creature with power 4 or greater, this spell costs {2} less to cast.",
    "toughness": "",
    "types": "Instant",
    "url": ""
  }
]

},{}],2:[function(require,module,exports){
const fetch = globalThis.fetch || require('node-fetch')

const cardCountTable = new Map([
  [1, 9],
  [2, 15],
  [3, 11],
  [4, 7],
  [5, 3],
  [6, 4],
])
const manaCostSymbol = new Map([
  ['red', '{R}'],
  ['green', '{G}'],
  ['black', '{B}'],
  ['white', '{W}'],
  ['blue', '{U}'],
])

const savedDeck = localStorage.getItem('deck')

let playerState = {
  deck: savedDeck ? JSON.parse(savedDeck) : require('./default-deck.json'),
  hand: [],
  playfield: [],
  graveyard: [],
  loading: false,
}

startGame()


function startGame() {
  render()
}

function render () {
  document.body.innerHTML = playerState.loading ? 'loading...' : (`
    ${generateDeckButton(playerState)}
    ${renderDeck(playerState)}
    ${drawCardButton(playerState)}
    ${renderCardSet('hand', playerState.hand, (card) => renderCardActions(card, 'hand', playerState))}
    ${renderCardSet('playfield', playerState.playfield, (card) => renderCardActions(card, 'playfield', playerState))}
    ${renderCardSet('discard', playerState.graveyard, (card) => renderCardActions(card, 'graveyard', playerState))}
  `)
}

function generateDeckButton(playerState) {
  globalThis.generateDeck = async () => {
    playerState.loading = true
    render()
    const deck = await getDeck()
    console.log(deck)
    localStorage.setItem('deck', JSON.stringify(deck))
    playerState.deck = deck
    playerState.hand = []
    playerState.loading = false
    render()
  }
  return (`
    <button onclick="generateDeck()">generate deck</button>
  `)
}

function drawCardButton(playerState) {
  globalThis.drawCard = async () => {
    console.log('draw card')
    const { hand, deck } = playerState
    moveCard(deck[deck.length - 1].id, deck, hand)
    render()
  }
  return (`
    <button onclick="drawCard()">draw card</button>
  `)
}

function renderDeck(playerState) {
  return (`
    <div>deck: ${playerState.deck.length}</div>
  `)
}

function renderCardSet (label, cards, contextActions) {
  return (`
  <div>${label}: ${cards.length}</div>
  <ul>
    ${cards.map(card => {
      return (`
        <li>
        ${renderCard(card)}
        ${contextActions(card, playerState)}
        </li>
      `)
    }).join('\n')}
  </ul>
`)
}

function renderCard (card) {
  const { name, types, manaCost, text, power, toughness, flavorText, rarity } = card
  return (`
  <div>
    ${name || 'nameless?'}
    ${manaCost}
    ${types} (${rarity})
    <pre>
      ${text}
      ${power !== '' ? `${power}/${toughness}` : ''}
      "${flavorText}"
    </pre>
  </div>
  `)
}

function renderCardActions (card, contextLocation, playerState) {
  globalThis.cardActionMove = (cardId, fromName, toName, push = true) => {
    console.log('card action', cardId, fromName, toName, push)
    moveCard(cardId, playerState[fromName], playerState[toName], push)
    render()
  }
  return [
    'move to:',
    contextLocation ==='hand' ? null : `<button onclick="cardActionMove('${card.id}', '${contextLocation}', 'hand')">hand</button>`,
    contextLocation ==='playfield' ? null : `<button onclick="cardActionMove('${card.id}', '${contextLocation}', 'playfield')">playfield</button>`,
    contextLocation ==='graveyard' ? null : `<button onclick="cardActionMove('${card.id}', '${contextLocation}', 'graveyard')">graveyard</button>`,
    contextLocation ==='deck' ? null : `<button onclick="cardActionMove('${card.id}', '${contextLocation}', 'deck')">top of deck</button>`,
    contextLocation ==='deck' ? null : `<button onclick="cardActionMove('${card.id}', '${contextLocation}', 'deck', false)">bottom of deck</button>`,
  ].filter(Boolean).join('\n')
}

function moveCard (cardId, currentLocation, targetLocation, push = true) {
  const cardIndex = currentLocation.findIndex(card => card.id === cardId)
  const card = currentLocation[cardIndex]
  currentLocation.splice(cardIndex, 1)
  if (push) {
    targetLocation.push(card)
  } else {
    targetLocation.unshift(card)
  }
}

async function getDeck () {
  const deckParams = generateDeckParams()
  const deck = await Promise.all(deckParams.map(async (cardArgs) => {
    const card = await getCard(cardArgs)
    card.id = Math.random().toString().slice(2)
    // console.log(cardArgs, card)
    return card
  }))
  return deck
}

function generateDeckParams () {
  const deckPalette = ['red']
  const deckParams = []
  cardCountTable.forEach((count, cardTotalCost) => {
    for (let i = 0; i < count; i++) {
      const manaCost = randomCostFromTotalCost(cardTotalCost, deckPalette)
      // console.log(cardTotalCost, manaCost, manaCostToString(manaCost))
      deckParams.push({
        manaCost: manaCostToString(manaCost),
      })
    }
  })
  return deckParams
}

function randomCostFromTotalCost (cardTotalCost, deckPalette) {
  const primaryColor = deckPalette[0]
  const manaCost = new Map()
  for (let i = 0; i < cardTotalCost; i++) {
    const color = randomChance(0.3) ? primaryColor : 'colorless'
    const colorCost = manaCost.get(color) || 0
    manaCost.set(color, colorCost + 1)
  }
  return manaCost
}


function randomChance (chance) {
  return Math.random() < chance
}

function manaCostToString(manaCost) {
  let costString = ''
  if (manaCost.has('colorless')) {
    costString += `{${manaCost.get('colorless')}}`
  }
  ;[...manaCost.keys()]
    .filter(color => color !== 'colorless')
    .forEach(color => {
      costString += Array(manaCost.get(color))
        .fill(manaCostSymbol.get(color))
        .join('')
    })
  return costString
}

async function getCard (cardArgs = {}) {
  const presets = Object.assign({
    "name":"",
    "manaCost":"",
    "types":"",
    "subtypes":"",
    "text":"",
    "power":"",
    "toughness":"",
    "flavorText":"",
    "rarity":"",
    "loyalty":"",
    "url":"",
    "basic_land":"",
  }, cardArgs)
  const presetString = JSON.stringify(presets)
  const res = await fetch(`https://backend-dot-valued-sight-253418.ew.r.appspot.com/api/v1/card?presets=${presetString}`, { 'method': 'GET'});
  const json = await res.json();
  return json
}

},{"./default-deck.json":1,"node-fetch":3}],3:[function(require,module,exports){

},{}]},{},[2]);
